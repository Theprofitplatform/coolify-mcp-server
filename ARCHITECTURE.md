# ğŸ—ï¸ Auto-Deploy Architecture

**Complete system architecture and data flow documentation**

---

## ğŸ“Š High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AUTO-DEPLOY ECOSYSTEM                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Developer â†’ GitHub â†’ N8N Webhook â†’ Coolify API â†’ Container     â”‚
â”‚                â†“         â†“              â†“             â†“          â”‚
â”‚             Commit    Process      API Call     Deployment       â”‚
â”‚                         â†“                           â†“            â”‚
â”‚                   Health Check â† Success? â†’ Rollback             â”‚
â”‚                         â†“                           â†“            â”‚
â”‚                   Notification              Notification         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Detailed Data Flow

### 1. Complete Deployment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Developer   â”‚
â”‚  writes code â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ git push
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Repository   â”‚
â”‚  (main or develop)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Webhook Event
       â”‚ POST /webhook/github-deploy
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     N8N WORKFLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ Webhook Trigger â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚           â”‚                                                   â”‚
â”‚           â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Parse Event Data â”‚          â”‚  Filter Branch   â”‚          â”‚
â”‚  â”‚  - repo name     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  - main?         â”‚          â”‚
â”‚  â”‚  - branch        â”‚          â”‚  - develop?      â”‚          â”‚
â”‚  â”‚  - commit sha    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”‚  - author        â”‚                   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â†“                    â”‚
â”‚                                                               â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â”‚   PRE-DEPLOYMENT CHECKS      â”‚                   â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚           â”‚                              â”‚                   â”‚
â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                   â”‚
â”‚           â”‚  â”‚ Health Check (Pre) â”‚      â”‚                   â”‚
â”‚           â”‚  â”‚ GET /health        â”‚      â”‚                   â”‚
â”‚           â”‚  â”‚ Status: 200 OK?    â”‚      â”‚                   â”‚
â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                   â”‚
â”‚           â”‚         â”‚ âœ“ Pass             â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                     â”‚                                         â”‚
â”‚                     â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚        COOLIFY API CALL                       â”‚           â”‚
â”‚  â”‚  POST /api/v1/applications/{uuid}/deploy     â”‚           â”‚
â”‚  â”‚  Authorization: Bearer {token}                â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â”œâ”€ Success (200) â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                      â”‚                        â”‚              â”‚
â”‚                      â””â”€ Failure (4xx/5xx) â”€â”€â”€â”¼â”€â”€â”€â†’ FAILED   â”‚
â”‚                                               â”‚              â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                      â†“                                       â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚           â”‚     WAIT FOR DEPLOYMENT      â”‚                  â”‚
â”‚           â”‚   (30 seconds default)       â”‚                  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â†“                                       â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚           â”‚  POST-DEPLOYMENT CHECKS      â”‚                  â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚           â”‚                              â”‚                  â”‚
â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                  â”‚
â”‚           â”‚  â”‚ Health Check (Post)â”‚      â”‚                  â”‚
â”‚           â”‚  â”‚ GET /health        â”‚      â”‚                  â”‚
â”‚           â”‚  â”‚ Retry: 5 attempts  â”‚      â”‚                  â”‚
â”‚           â”‚  â”‚ Delay: 5s each     â”‚      â”‚                  â”‚
â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                  â”‚
â”‚           â”‚         â”‚                    â”‚                  â”‚
â”‚           â”‚         â”œâ”€ âœ“ Pass â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â†’ SUCCESS      â”‚
â”‚           â”‚         â”‚                    â”‚                  â”‚
â”‚           â”‚         â””â”€ âœ— Fail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â†’ ROLLBACK     â”‚
â”‚           â”‚                              â”‚                  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                           â”‚
       â†“ Success                                   â†“ Failure
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Success Message  â”‚                    â”‚  Rollback Trigger   â”‚
â”‚ - Slack          â”‚                    â”‚  POST /rollback     â”‚
â”‚ - Email          â”‚                    â”‚                     â”‚
â”‚ - Dashboard      â”‚                    â”‚  Then:              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  - Failure Message  â”‚
                                        â”‚  - Alert Team       â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Component Architecture

### System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GITHUB                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Repository                                                â”‚   â”‚
â”‚  â”‚  - Source code                                            â”‚   â”‚
â”‚  â”‚  - .coolify/deploy.json (config)                          â”‚   â”‚
â”‚  â”‚  - Webhook configured                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Webhook POST
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            N8N                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Workflow Engine                                           â”‚   â”‚
â”‚  â”‚  - Webhook receiver                                       â”‚   â”‚
â”‚  â”‚  - Data transformer                                       â”‚   â”‚
â”‚  â”‚  - API orchestrator                                       â”‚   â”‚
â”‚  â”‚  - Error handler                                          â”‚   â”‚
â”‚  â”‚  - Notification sender                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ REST API Calls
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COOLIFY                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ API Server                                                â”‚   â”‚
â”‚  â”‚  /api/v1/applications/{uuid}/deploy                       â”‚   â”‚
â”‚  â”‚  /api/v1/applications/{uuid}/rollback                     â”‚   â”‚
â”‚  â”‚  /api/v1/applications/{uuid}/resources                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Container Orchestrator                                    â”‚   â”‚
â”‚  â”‚  - Docker/Podman                                          â”‚   â”‚
â”‚  â”‚  - Image builder                                          â”‚   â”‚
â”‚  â”‚  - Container manager                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       APPLICATION                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Running Container                                         â”‚   â”‚
â”‚  â”‚  - Your application code                                  â”‚   â”‚
â”‚  â”‚  - /health endpoint                                       â”‚   â”‚
â”‚  â”‚  - Public domain                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Configuration Flow

### How Configuration Reaches Each Component

```
.coolify/deploy.json (in repo)
    â”‚
    â”œâ”€â–º environments.production
    â”‚       â””â”€â–º coolify_app_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â””â”€â–º domain                         â”‚
    â”‚       â””â”€â–º health_check_url              â”‚
    â”‚                                          â”‚
    â””â”€â–º environments.staging                   â”‚
            â””â”€â–º coolify_app_id                 â”‚
            â””â”€â–º domain                         â”‚
            â””â”€â–º health_check_url              â”‚
                                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
            N8N Workflow Configuration
                    â”‚
                    â”œâ”€â–º Parse deployment config
                    â”œâ”€â–º Select environment by branch
                    â”œâ”€â–º Extract app UUID
                    â””â”€â–º Build API URLs
                    â”‚
                    â†“
            Coolify API Calls
                    â”‚
                    â”œâ”€â–º POST /applications/{uuid}/deploy
                    â”œâ”€â–º GET  /applications/{uuid}/resources
                    â””â”€â–º POST /applications/{uuid}/rollback
                    â”‚
                    â†“
            Container Deployment
```

---

## ğŸ” Security Architecture

### Token & Credential Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Environment Setup   â”‚
â”‚  (Developer Machine) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“ Load from .env
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Environment Variables           â”‚
â”‚                                  â”‚
â”‚  COOLIFY_TOKEN=xxx              â”‚
â”‚  COOLIFY_BASE_URL=...           â”‚
â”‚  N8N_URL=...                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                              â”‚
           â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Setup Script        â”‚      â”‚  N8N Workflow        â”‚
â”‚  (Local)             â”‚      â”‚  (Server)            â”‚
â”‚                      â”‚      â”‚                      â”‚
â”‚  - Creates config    â”‚      â”‚  Token stored in:    â”‚
â”‚  - Tests API         â”‚      â”‚  - N8N credentials   â”‚
â”‚  - Validates access  â”‚      â”‚  - Workflow nodes    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  - Encrypted at rest â”‚
           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â”‚                             â†“
           â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                  â”‚  API Requests        â”‚
           â”‚                  â”‚                      â”‚
           â”‚                  â”‚  Authorization:      â”‚
           â”‚                  â”‚  Bearer {token}      â”‚
           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                         â”‚
                                         â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Coolify API Server  â”‚
                              â”‚                      â”‚
                              â”‚  - Validates token   â”‚
                              â”‚  - Checks permissionsâ”‚
                              â”‚  - Executes action   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Layers

1. **Token Storage**
   - âœ… Environment variables (not in code)
   - âœ… .env file (gitignored)
   - âœ… N8N credentials (encrypted)

2. **API Communication**
   - âœ… HTTPS only
   - âœ… Bearer token authentication
   - âœ… Token scoped to specific permissions

3. **Webhook Security**
   - âœ… HTTPS endpoint
   - âš ï¸ Optional: Webhook secret validation

---

## ğŸ¯ Multi-Environment Architecture

### Environment Separation

```
                    GitHub Repository
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚               â”‚
         develop         main          feature/*
            â”‚               â”‚               â”‚
            â†“               â†“               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  N8N Webhook  â”‚ â”‚  N8N Webhook  â”‚ â”‚  N8N Webhook  â”‚
    â”‚  (Staging)    â”‚ â”‚  (Production) â”‚ â”‚  (Preview)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
            â†“                 â†“                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Coolify App  â”‚ â”‚  Coolify App  â”‚ â”‚  Coolify App  â”‚
    â”‚  Staging UUID â”‚ â”‚  Prod UUID    â”‚ â”‚  Preview UUID â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
            â†“                 â†“                 â†“
    test.domain.com   app.domain.com    pr-123.domain.com
```

### Configuration per Environment

```yaml
environments:
  production:
    branch: main
    domain: app.theprofitplatform.com.au
    coolify_app_id: prod-uuid-here
    force_rebuild: true          # â† Safe, full rebuild
    run_tests: true              # â† Required
    health_check: true           # â† Required
    auto_rollback_on_failure: true

  staging:
    branch: develop
    domain: test.theprofitplatform.com.au
    coolify_app_id: staging-uuid-here
    force_rebuild: false         # â† Fast, use cache
    run_tests: true              # â† Still test
    health_check: true           # â† Still verify
    auto_rollback_on_failure: true

  preview:
    branch: "feature/*"
    domain: "pr-*.theprofitplatform.com.au"
    coolify_app_id: preview-uuid-here
    force_rebuild: false         # â† Fastest
    run_tests: false             # â† Skip for speed
    health_check: false          # â† Skip for speed
    auto_rollback_on_failure: false
```

---

## ğŸ“Š Performance & Scalability

### Deployment Times

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Typical Deployment Times               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Small App (< 100MB)                                   â”‚
â”‚  â”œâ”€ Build time:     20-40 seconds                      â”‚
â”‚  â”œâ”€ Deploy time:    10-20 seconds                      â”‚
â”‚  â””â”€ Total:          30-60 seconds                      â”‚
â”‚                                                         â”‚
â”‚  Medium App (100-500MB)                                â”‚
â”‚  â”œâ”€ Build time:     1-2 minutes                        â”‚
â”‚  â”œâ”€ Deploy time:    30-60 seconds                      â”‚
â”‚  â””â”€ Total:          1-3 minutes                        â”‚
â”‚                                                         â”‚
â”‚  Large App (> 500MB)                                   â”‚
â”‚  â”œâ”€ Build time:     3-8 minutes                        â”‚
â”‚  â”œâ”€ Deploy time:    1-2 minutes                        â”‚
â”‚  â””â”€ Total:          4-10 minutes                       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Factors affecting speed:
- force_rebuild: true vs false (30-50% time difference)
- Dependencies: Node modules, Python packages
- Image layers: Cached vs fresh
- Server resources: CPU, RAM, network
```

### Concurrent Deployments

```
N8N Workflow Concurrency
    â”‚
    â”œâ”€â–º Free Tier:  5 concurrent executions
    â”œâ”€â–º Pro Tier:   20 concurrent executions
    â””â”€â–º Custom:     Unlimited
    â”‚
    â†“
Coolify API Rate Limits
    â”‚
    â”œâ”€â–º Per second:  10 requests
    â”œâ”€â–º Per minute:  100 requests
    â””â”€â–º Per hour:    1,000 requests
    â”‚
    â†“
Deployment Queue
    â”‚
    â”œâ”€â–º Serial per app:  1 at a time
    â”œâ”€â–º Parallel apps:   Unlimited
    â””â”€â–º Queue overflow:  Wait or fail
```

---

## ğŸ”„ Error Handling & Recovery

### Failure Scenarios

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ERROR HANDLING FLOW                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Deployment Initiated                                     â”‚
â”‚          â”‚                                                â”‚
â”‚          â”œâ”€ API Call Fails (timeout, 4xx, 5xx)           â”‚
â”‚          â”‚       â”‚                                        â”‚
â”‚          â”‚       â””â”€â–º Retry (3 attempts, 5s delay)        â”‚
â”‚          â”‚                â”‚                               â”‚
â”‚          â”‚                â”œâ”€ Success â†’ Continue           â”‚
â”‚          â”‚                â””â”€ Fail â†’ Alert & Stop          â”‚
â”‚          â”‚                                                â”‚
â”‚          â”œâ”€ Build Fails                                   â”‚
â”‚          â”‚       â”‚                                        â”‚
â”‚          â”‚       â””â”€â–º Keep previous version running        â”‚
â”‚          â”‚            Alert team via Slack/Email          â”‚
â”‚          â”‚                                                â”‚
â”‚          â”œâ”€ Deploy Succeeds but Health Check Fails       â”‚
â”‚          â”‚       â”‚                                        â”‚
â”‚          â”‚       â””â”€â–º Automatic Rollback                   â”‚
â”‚          â”‚            â”œâ”€ POST /rollback                   â”‚
â”‚          â”‚            â”œâ”€ Verify rollback health           â”‚
â”‚          â”‚            â””â”€ Alert with error details         â”‚
â”‚          â”‚                                                â”‚
â”‚          â””â”€ All OK â†’ Success notification                 â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rollback Process

```
Health Check Failed
    â”‚
    â†“
Trigger Rollback
    â”‚
    â”œâ”€â–º 1. Call Coolify rollback API
    â”‚      POST /applications/{uuid}/rollback
    â”‚
    â”œâ”€â–º 2. Wait for rollback completion (30s)
    â”‚
    â”œâ”€â–º 3. Verify old version is running
    â”‚      GET /health (should return 200)
    â”‚
    â”œâ”€â–º 4. Notify team of rollback
    â”‚      "Deployment failed, rolled back to v{previous}"
    â”‚
    â””â”€â–º 5. Log failure details for investigation
```

---

## ğŸ“ˆ Monitoring & Observability

### What Gets Logged

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   N8N LOGS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â€¢ Webhook received                                     â”‚
â”‚    - Timestamp                                          â”‚
â”‚    - Repository name                                    â”‚
â”‚    - Branch                                             â”‚
â”‚    - Commit SHA                                         â”‚
â”‚    - Commit author                                      â”‚
â”‚    - Commit message                                     â”‚
â”‚                                                         â”‚
â”‚  â€¢ Deployment started                                   â”‚
â”‚    - App UUID                                           â”‚
â”‚    - Environment                                        â”‚
â”‚    - Force rebuild?                                     â”‚
â”‚                                                         â”‚
â”‚  â€¢ Health checks                                        â”‚
â”‚    - Pre-deploy status                                  â”‚
â”‚    - Post-deploy status                                 â”‚
â”‚    - Response time                                      â”‚
â”‚    - Retry attempts                                     â”‚
â”‚                                                         â”‚
â”‚  â€¢ Deployment result                                    â”‚
â”‚    - Success/failure                                    â”‚
â”‚    - Duration                                           â”‚
â”‚    - Error message (if failed)                          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COOLIFY LOGS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â€¢ Build logs                                           â”‚
â”‚    - Docker build output                                â”‚
â”‚    - Dependency installation                            â”‚
â”‚    - Compilation results                                â”‚
â”‚                                                         â”‚
â”‚  â€¢ Deployment logs                                      â”‚
â”‚    - Container creation                                 â”‚
â”‚    - Port mapping                                       â”‚
â”‚    - Environment variables                              â”‚
â”‚    - Health check results                               â”‚
â”‚                                                         â”‚
â”‚  â€¢ Application logs                                     â”‚
â”‚    - stdout/stderr                                      â”‚
â”‚    - Application errors                                 â”‚
â”‚    - Request logs                                       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Maintenance & Operations

### Regular Operations

```
Daily:
  â”œâ”€ Monitor deployment success rate
  â”œâ”€ Check error logs in N8N
  â””â”€ Review Coolify resource usage

Weekly:
  â”œâ”€ Review deployment performance
  â”œâ”€ Check for failed deployments
  â”œâ”€ Update deployment configs if needed
  â””â”€ Test rollback procedure

Monthly:
  â”œâ”€ Rotate API tokens
  â”œâ”€ Review N8N workflow performance
  â”œâ”€ Update documentation
  â”œâ”€ Optimize slow deployments
  â””â”€ Audit security settings

Quarterly:
  â”œâ”€ Review architecture
  â”œâ”€ Plan improvements
  â”œâ”€ Update dependencies
  â””â”€ Conduct disaster recovery test
```

---

## ğŸ“š Related Documentation

- **Setup Guide**: AUTO-DEPLOY-SETUP.md
- **Quick Start**: QUICK-START-AUTO-DEPLOY.md
- **Configuration**: templates/README.md
- **Review**: AUTO-DEPLOY-REVIEW.md

---

**Last Updated:** 2025-11-13
**Version:** 1.0.0

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
